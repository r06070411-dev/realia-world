<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>REALIA WORLD (Debug)</title>
  <style>
    html,body{margin:0;height:100%;overflow:hidden;background:#000}
    #msg{
      position:fixed;left:12px;top:12px;z-index:10;
      font:13px -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial;
      color:#fff;background:rgba(0,0,0,.45);padding:10px 12px;border-radius:10px;
      border:1px solid rgba(255,255,255,.15);max-width:calc(100vw - 24px)
    }
    canvas{display:block}
  </style>
</head>
<body>
  <div id="msg">読み込み中...</div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
  <script>
    const msg = document.getElementById('msg');

    // three.js が読み込めていない場合
    if (!window.THREE) {
      msg.textContent = "three.js の読み込みに失敗しました（CDNブロック/通信/キャッシュ）。";
      throw new Error("THREE not loaded");
    }

    // WebGL が使えるかチェック
    const testCanvas = document.createElement('canvas');
    const gl = testCanvas.getContext('webgl') || testCanvas.getContext('experimental-webgl');
    if (!gl) {
      msg.textContent = "この端末/ブラウザで WebGL が使えません（設定/ブロッカー等）。";
      throw new Error("WebGL not available");
    }

    // シーン
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x1a1f3a); // 背景を明るめに

    const camera = new THREE.PerspectiveCamera(70, innerWidth/innerHeight, 0.1, 1000);
    camera.position.set(10, 10, 10);
    camera.lookAt(0, 0, 0);

    const renderer = new THREE.WebGLRenderer({ antialias:true });
    renderer.setSize(innerWidth, innerHeight);
    renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
    document.body.appendChild(renderer.domElement);

    // ライト（強め）
    scene.add(new THREE.AmbientLight(0xffffff, 0.8));
    const dir = new THREE.DirectionalLight(0xffffff, 1.2);
    dir.position.set(10, 20, 10);
    scene.add(dir);

    // 地面（見えやすい色）
    const ground = new THREE.Mesh(
      new THREE.PlaneGeometry(200, 200),
      new THREE.MeshStandardMaterial({ color: 0x2b2f55, roughness: 1 })
    );
    ground.rotation.x = -Math.PI/2;
    scene.add(ground);

    // デバッグ用：原点の赤い立方体（これが見えなければ描画自体が死んでます）
    const cube = new THREE.Mesh(
      new THREE.BoxGeometry(2,2,2),
      new THREE.MeshStandardMaterial({ color: 0xff3344, emissive: 0x220000 })
    );
    cube.position.set(0,1,0);
    scene.add(cube);

    // 建物（サイズ大きめ・明るめ）
    const buildings = [];
    const boxGeo = new THREE.BoxGeometry(2,2,2);
    for(let x=-20;x<=20;x+=5){
      for(let z=-20;z<=20;z+=5){
        if (x===0 && z===0) continue;
        const h = 2 + Math.random()*10;
        const b = new THREE.Mesh(
          boxGeo,
          new THREE.MeshStandardMaterial({ color: 0x66aaff, emissive: 0x111122 })
        );
        b.scale.set(1, h/2, 1);
        b.position.set(x, (h/2)/2, z);
        scene.add(b);
        buildings.push(b);
      }
    }

    msg.textContent = "表示OK：赤い立方体と地面が見えますか？（見えたら次に通常版へ戻します）";

    function animate(){
      requestAnimationFrame(animate);
      cube.rotation.y += 0.01;
      renderer.render(scene, camera);
    }
    animate();

    addEventListener('resize', ()=>{
      camera.aspect = innerWidth/innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(innerWidth, innerHeight);
    });
  </script>
</body>
</html>
